<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
  <title>Educational Sadaqah | ٱلصَّدَقَةُ ٱلدِّرَاسِيَّةُ</title>
  
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&family=IBM+Plex+Sans+Arabic:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
  
  <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />
  
  <script defer src="https://unpkg.com/lucide@latest"></script>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/es6-promise/4.2.8/es6-promise.auto.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fetch/3.6.2/fetch.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

   <style>
    /* ===== لوحة ألوان جديدة باللون الأصفر الذهبي ===== */
    :root {
      --primary-1: #FFD700; /* أصفر ذهبي */
      --primary-2: #FFE55C; /* أصفر فاتح */
      --primary-3: #FFB300; /* أصفر داكن */
      --accent: #FFA000; /* برتقالي أصفر */
      --accent-2: #F57C00; /* برتقالي داكن */
      --radius: 16px;
      --speed: .25s cubic-bezier(.4,0,.2,1);
      --bg: #121212; /* أسود غير متوهج */
      --bg-glass: rgba(18, 18, 18, 0.95);
      --text: #FFECB3; /* أصفر فاتح جداً للنصوص */
      --card: #1E1E1E; /* رمادي داكن للبطاقات */
      --border: #FFD700; /* أصفر فاتح للحدود */
      --hover: rgba(255, 215, 0, 0.1); /* أصفر شفاف للهافر */
      --gradient: linear-gradient(135deg, var(--primary-1), var(--primary-2) 45%, var(--accent));
      --gradient-animated: linear-gradient(-45deg, var(--primary-1), var(--primary-2), var(--accent), var(--primary-1));
      --success: #4CAF50;
      --warning: #FFC107;
      --error: #F44336;
      --glow: 0 0 10px rgba(255, 215, 0, 0.3); /* توهج خفيف */
      
      /* متغيرات جديدة للون الأزرق للمشغل فقط */
      --player-primary: #2196F3; /* أزرق فاتح */
      --player-accent: #1976D2; /* أزرق متوسط */
      --player-hover: rgba(33, 150, 243, 0.1); /* أزرق شفاف للهافر */
      --player-glow: 0 0 10px rgba(33, 150, 243, 0.3); /* توهج أزرق */
    }
    
    [data-theme="light"] {
      --bg: #f5f5f5;
      --bg-glass: rgba(245, 245, 245, 0.95);
      --text: #333;
      --card: #ffffff;
      --border: #FFA000;
      --hover: rgba(255, 193, 7, 0.15);
      --accent: #FF9800;
    }

    /* ===== أساسيات ===== */
    *, *:before, *:after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Cairo', 'IBM Plex Sans Arabic', 'Tajawal', sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.8;
      scroll-behavior: smooth;
      min-height: 100vh;
      overflow-y: auto;
      background-image: radial-gradient(circle at 25% 10%, rgba(255, 215, 0, 0.05) 0%, transparent 55%),
                        radial-gradient(circle at 75% 90%, rgba(255, 160, 0, 0.05) 0%, transparent 55%);
    }
    
    img {
      max-width: 100%;
      display: block;
    }
    
    button {
      font-family: inherit;
      cursor: pointer;
      border: none;
      background: none;
    }

    /* ===== أنيميشن عامة ===== */
    @keyframes fadeSlide {
      from { opacity: 0; transform: translateY(30px) }
      to { opacity: 1; transform: translateY(0) }
    }
    
    @keyframes spin {
      to { transform: rotate(360deg) }
    }
    
    @keyframes gradientShift {
      0% { background-position: 0% 50% }
      50% { background-position: 100% 50% }
      100% { background-position: 0% 50% }
    }
    
    @keyframes fadeIn {
      to { opacity: 1; transform: translateY(0) }
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }
    
    @keyframes scaleIn {
      from { transform: scale(0.9); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    /* ===== رأس الصفحة ===== */
    header {
      position: sticky;
      top: 0;
      z-index: 1000;
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem 1.6rem;
      background: var(--bg-glass);
      backdrop-filter: blur(14px);
      border-bottom: 1px solid var(--border);
      box-shadow: var(--glow);
      flex-wrap: wrap;
    }
    
    .site-title {
      font-size: clamp(1.5rem, 5vw, 2.2rem);
      font-weight: 700;
      background: var(--gradient-animated);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      background-size: 400% 400%;
      animation: gradientShift 8s ease infinite;
      transition: transform var(--speed);
      white-space: nowrap;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      flex: 1;
      min-width: 200px;
    }
    
    .site-title:hover {
      transform: scale(1.07);
    }
    
    .site-logo {
      width: 40px;
      height: 40px;
      border-radius: 8px;
      object-fit: cover;
    }
    
    .header-actions {
      display: flex;
      gap: 0.8rem;
      flex-wrap: wrap;
    }

    /* ===== البحث ===== */
    .search-container {
      flex: 1;
      max-width: 650px;
      display: flex;
      gap: .5rem;
      position: relative;
      min-width: 250px;
      margin-top: 0.5rem;
    }
    
    .search-container input {
      flex: 1;
      padding: .95rem 1rem .95rem 3rem;
      font-size: 1rem;
      background: var(--card);
      color: var(--text);
      border: 2px solid var(--border);
      border-radius: var(--radius);
      transition: border var(--speed), box-shadow var(--speed);
      box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
    }
    
    .search-container input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(255, 152, 0, .25);
    }
    
    .search-icon {
      position: absolute;
      left: 1rem;
      top: 50%;
      transform: translateY(-50%);
      color: var(--primary-1);
    }

    /* ===== الأزرار ===== */
    .btn {
      display: inline-flex;
      align-items: center;
      gap: .45rem;
      padding: .9rem 1.35rem;
      border-radius: var(--radius);
      background: var(--gradient);
      color: #333;
      font-weight: 600;
      transition: all var(--speed);
      white-space: nowrap;
      box-shadow: var(--glow);
    }
    
    .btn:hover {
      opacity: .9;
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(0,0,0,0.15), var(--glow);
    }
    
    .btn-outline {
      background: transparent;
      border: 2px solid var(--primary-1);
      color: var(--primary-1);
    }
    
    .btn-icon {
      padding: 0.8rem;
      border-radius: 50%;
      width: 42px;
      height: 42px;
      justify-content: center;
    }
    
    .btn-accent {
      background: var(--accent);
      color: white;
    }
    
    .btn-accent:hover {
      background: var(--accent-2);
    }

    /* ===== الصفحات ===== */
    .page {
      display: none;
      padding: 2rem;
      max-width: 1300px;
      margin: 0 auto;
    }
    
    .page.active {
      display: block;
      animation: fadeSlide var(--speed);
    }

    /* ===== شبكة المدرسين ===== */
    .teachers-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 1.8rem;
      justify-items: center;
    }
    
    .teacher-card {
      width: 100%;
      background: var(--card);
      padding: 1.4rem 1.1rem;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      text-align: center;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      transition: transform var(--speed), box-shadow var(--speed), border var(--speed);
      box-shadow: var(--glow);
      opacity: 0;
      transform: translateY(20px);
      animation: fadeIn .5s ease forwards;
      animation-delay: calc(.07s * var(--i,0));
    }
    
    .teacher-card:before {
      content: "";
      position: absolute;
      inset: 0;
      background: var(--gradient);
      opacity: .1;
      mix-blend-mode: screen;
      transform: scale(1.4) rotate(45deg);
    }
    
    .teacher-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 18px 38px rgba(0,0,0,.10), var(--glow);
      border-color: var(--accent);
    }
    
    .teacher-card:active {
      transform: scale(.97);
    }
    
    .teacher-img {
      width: 160px;
      height: 160px;
      border-radius: 50%;
      object-fit: cover;
      margin: 0 auto 1rem;
      border: 4px solid var(--accent);
      box-shadow: var(--glow);
    }
    
    .teacher-name {
      font-size: 1.25rem;
      font-weight: 700;
      margin: .4rem 0 .15rem;
      color: var(--primary-1);
    }
    
    .teacher-subject {
      opacity: .85;
      font-size: .92rem;
      margin-bottom: 0.5rem;
      color: var(--primary-2);
    }

    /* ===== صفحة المدرس ===== */
    .teacher-info {
      display: flex;
      align-items: center;
      gap: 1.4rem;
      background: var(--card);
      padding: 1.6rem;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      flex-wrap: wrap;
      box-shadow: var(--glow);
      animation: float 6s ease-in-out infinite;
    }
    
    .teacher-img-lg {
      width: 130px;
      height: 130px;
      border-radius: 50%;
      object-fit: cover;
      border: 4px solid var(--accent);
      box-shadow: var(--glow);
    }

    /* ===== الفصول ===== */
    .classes-list {
      display: grid;
      gap: 1.4rem;
      margin-top: 1.4rem;
    }
    
    .class-card {
      background: var(--card);
      border-radius: var(--radius);
      border: 1px solid var(--border);
      overflow: hidden;
      box-shadow: var(--glow);
      transition: transform var(--speed);
    }
    
    .class-card:hover {
      transform: translateY(-5px);
    }
    
    .class-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1.1rem 1.3rem;
      cursor: pointer;
      user-select: none;
      background: var(--bg-glass);
      backdrop-filter: blur(8px);
      border-right: 4px solid var(--primary-2);
      transition: background var(--speed);
    }
    
    .class-header:hover {
      background: var(--hover);
    }
    
    .class-header span {
      transition: transform var(--speed);
    }
    
    .class-header.open span {
      transform: rotate(180deg);
    }
    
    .lectures-list {
      display: none;
      flex-direction: column;
      gap: .7rem;
      padding: 1.1rem 1.5rem .9rem 0;
    }
    
    .lecture-item {
      position: relative;
      padding: .9rem 1.1rem .9rem 3.5rem;
      background: #2a2a2a; /* أسود فاتح بدون صفار */
      border-right: 3px solid #444; /* لون رمادي داكن */
      border-radius: var(--radius);
      cursor: pointer;
      transition: all var(--speed);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .lecture-item:hover {
      transform: translateX(10px);
      background: #333; /* لون أغمق قليلاً عند التحويم */
    }
    
    .lecture-item i {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--primary-1); /* أصفر للمؤشر فقط */
    }
    
    .lecture-duration {
      background: rgba(255, 255, 255, 0.1); /* لون محايد */
      color: #ccc; /* لون رمادي للنص */
      padding: 0.25rem 0.5rem;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
    }
    
    .lecture-progress {
      position: absolute;
      bottom: 0;
      left: 0;
      height: 3px;
      background: var(--accent); /* تقدم أصفر */
      border-radius: 0 0 0 var(--radius);
    }

    /* ===== الفيديو ===== */
    .video-page {
      display: flex;
      flex-direction: column;
      gap: 2rem;
      max-width: 1000px;
      margin: 0 auto;
      padding: 0 1rem;
    }
    
    .video-container {
      position: relative;
      width: 100%;
      background: #000;
      border-radius: var(--radius);
      overflow: hidden;
      box-shadow: var(--player-glow); /* توهج أزرق */
    }
    
    .plyr {
      border-radius: var(--radius);
      overflow: hidden;
    }
    
    /* Loader */
    #loader {
      position: absolute;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      background: rgba(0,0,0,.8);
      z-index: 3;
    }
    
    #loader.show {
      display: flex;
    }
    
    .spinner {
      width: 60px;
      height: 60px;
      border: 6px solid var(--player-accent); /* أزرق */
      border-top-color: transparent;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    .video-container.loading::after {
      content: 'جار التحميل يرجى الانتظار لبعض الوقت';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--card);
      padding: 1rem 1.5rem;
      border-radius: var(--radius);
      color: var(--player-primary); /* أزرق */
      font-weight: bold;
      z-index: 4;
    }

    .video-details {
      background: var(--card);
      padding: 1.5rem;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      text-align: center;
      box-shadow: var(--glow);
    }
    
    /* معلومات الفيديو */
    .video-info {
      text-align: right;
      padding: 1rem 0;
    }
    
    .video-meta {
      display: flex;
      justify-content: center;
      gap: 1.5rem;
      margin-top: 1rem;
      opacity: 0.8;
      font-size: 0.9rem;
      flex-wrap: wrap;
    }
    
    .video-meta span {
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }
    
    .quality-selector {
      display: flex;
      justify-content: center;
      gap: 0.5rem;
      margin: 1rem 0;
      flex-wrap: wrap;
    }
    
    .quality-btn {
      padding: 0.5rem 1rem;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 20px;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .quality-btn.active {
      background: var(--player-primary); /* أزرق */
      color: white;
      border-color: var(--player-primary); /* أزرق */
    }
    
    .quality-btn:hover:not(.active) {
      background: var(--player-hover); /* أزرق شفاف */
    }

    /* ===== المودال ===== */
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.75);
      backdrop-filter: blur(14px) saturate(160%);
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 1rem;
      z-index: 2000;
      animation: fadeIn .3s ease;
    }
    
    .modal-content {
      position: relative;
      width: 100%;
      max-width: 450px;
      background: var(--card);
      border-radius: calc(var(--radius)*1.2);
      padding: 2.5rem 2rem;
      text-align: center;
      box-shadow: var(--glow);
      animation: scaleIn .4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      border: 2px solid var(--primary-1);
    }
    
    .modal-content img {
      width: 180px;
      height: 180px;
      object-fit: cover;
      border-radius: 50%;
      margin: 0 auto 1.5rem;
      border: 4px solid var(--accent);
      box-shadow: var(--glow);
    }
    
    .modal-content h3 {
      font-size: 1.6rem;
      margin-bottom: .8rem;
      color: var(--primary-1);
    }
    
    .modal-content p {
      font-size: 1.1rem;
      margin-bottom: 1.8rem;
      opacity: .9;
      line-height: 1.7;
      color: var(--primary-2);
    }
    
    .modal-actions {
      display: flex;
      gap: 1rem;
      justify-content: center;
      margin-top: 1.8rem;
      flex-wrap: wrap;
    }
    
    .close-channel {
      display: inline-flex;
      align-items: center;
      gap: .35rem;
      padding: .9rem 1.5rem;
      background: var(--border);
      color: #333;
      font-weight: 600;
      border-radius: var(--radius);
      transition: background var(--speed), transform var(--speed);
    }
    
    .close-channel:hover {
      background: var(--hover);
      transform: translateY(-2px);
    }
    
    /* ===== تحسينات للجوال ===== */
    @media (max-width: 768px) {
      header {
        flex-wrap: wrap;
        padding: .9rem 1rem;
        gap: .8rem;
      }
      
      .search-container {
        order: 3;
        width: 100%;
      }
      
      .btn span {
        display: none;
      }
      
      .teacher-img {
        width: 140px;
        height: 140px;
      }
      
      .video-details {
        padding: 1.2rem;
      }
      
      .modal-content {
        max-width: 95%;
        padding: 1.8rem 1.2rem;
      }
      
      .video-container {
        border-radius: 0 !important;
        margin: 0 -1rem;
        width: calc(100% + 2rem);
      }
      
      .lecture-item {
        padding-left: 2.5rem;
      }
      
      .video-meta {
        flex-direction: column;
        gap: 0.5rem;
        align-items: center;
      }
      
      .btn {
        padding: 0.8rem 1rem;
      }
    }
    
    @media (min-width: 1024px) {
      .video-container {
        height: 500px;
      }
    }
    
    @media (max-width: 480px) {
      .page {
        padding: 1rem;
      }
      
      .teacher-info {
        padding: 1rem;
        flex-direction: column;
        text-align: center;
      }
      
      .teacher-img-lg {
        margin-bottom: 1rem;
      }
      
      .site-title {
        font-size: 1.8rem;
      }
      
      .modal-content {
        padding: 1.5rem 1rem;
      }
      
      .modal-content h3 {
        font-size: 1.4rem;
      }
      
      .modal-content p {
        font-size: 0.95rem;
      }
    }
    
    /* ===== تحسينات جديدة ===== */
    .video-controls {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-top: 1rem;
      flex-wrap: wrap;
    }
    
    .error-message {
      color: #ff6b6b;
      background: rgba(255, 107, 107, 0.1);
      padding: 1rem;
      border-radius: var(--radius);
      margin: 1rem 0;
      text-align: center;
      display: none;
    }
    
    /* تصميم جديد للمشغل - تحسينات للجوال */
    .plyr--video .plyr__controls {
      background: rgba(0,0,0,0.7);
      backdrop-filter: blur(10px);
      padding: 10px;
    }
    
    .plyr--video .plyr__control {
      color: var(--player-primary); /* أزرق */
      background: transparent;
      transition: all 0.2s;
    }
    
    .plyr--video .plyr__control:hover {
      background: var(--player-hover); /* أزرق شفاف */
    }
    
    .plyr--video .plyr__progress__buffer {
      background: rgba(255,255,255,0.2);
    }
    
    .plyr--video .plyr__progress__container {
      background: rgba(255,255,255,0.1);
    }
    
    .plyr--video .plyr__volume--display {
      background: var(--player-accent); /* أزرق */
    }
    
    .plyr--video .plyr__control--overlaid {
      background: rgba(33, 150, 243, 0.8); /* أزرق شفاف */
    }
    
    .plyr--video .plyr__control--overlaid:hover {
      background: var(--player-accent); /* أزرق */
    }
    
    /* تحسينات شريط التقدم للجوال */
    .plyr--full-ui input[type=range] {
      --plyr-range-track-height: 4px;
    }
    
    .plyr--video .plyr__progress {
      --plyr-range-track-height: 4px;
      color: var(--player-primary); /* أزرق */
    }
    
    .plyr--video .plyr__progress__container {
      height: 6px;
    }
    
    .plyr--video .plyr__progress__buffer {
      height: 4px;
    }
    
    .plyr--video .plyr__progress__container:hover .plyr__progress__buffer {
      height: 6px;
    }
    
    .plyr--video .plyr__progress__container:hover .plyr__progress {
      height: 6px;
    }
    
    .plyr--video .plyr__time {
      font-size: 12px;
      color: var(--player-primary); /* أزرق */
    }
    
    /* أزرار أكبر للجوال */
    .plyr--video .plyr__control {
      width: 36px;
      height: 36px;
    }
    
    .plyr--video .plyr__control--overlaid {
      width: 50px;
      height: 50px;
    }
    
    .plyr--video .plyr__control svg {
      width: 18px;
      height: 18px;
    }
    
    .plyr--video .plyr__control--overlaid svg {
      width: 24px;
      height: 24px;
    }
    
    /* تحسينات إضافية للجوال */
    .plyr--video .plyr__controls__item {
      margin: 0 4px;
    }
    
    .plyr--video .plyr__controls__item:first-child {
      margin-left: 0 !important;
    }
    
    .plyr--video .plyr__controls__item:last-child {
      margin-right: 0 !important;
    }
    
    .player-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.5rem 1rem;
      background: rgba(0,0,0,0.5);
      color: white;
      font-size: 0.9rem;
      position: absolute;
      bottom: 60px;
      left: 0;
      right: 0;
      z-index: 5;
    }
    
    /* تحسينات للشاشات الصغيرة جدًا */
    @media (max-width: 400px) {
      .plyr--video .plyr__controls {
        padding: 6px;
      }
      
      .plyr--video .plyr__control {
        width: 30px;
        height: 30px;
      }
      
      .plyr--video .plyr__control--overlaid {
        width: 42px;
        height: 42px;
      }
      
      .plyr--video .plyr__control svg {
        width: 16px;
        height: 16px;
      }
      
      .plyr--video .plyr__control--overlaid svg {
        width: 20px;
        height: 20px;
      }
      
      .plyr--video .plyr__time {
        font-size: 10px;
      }
    }
    
    /* ===== تحسينات شريط التقدم ===== */
    .plyr__controls .plyr__controls__item[data-plyr="mute"],
    .plyr__controls .plyr__controls__item[data-plyr="volume"],
    .plyr__controls .plyr__controls__item[data-plyr="settings"],
    .plyr__controls .plyr__controls__item[data-plyr="pip"] {
      display: none !important;
    }
    
    .plyr__progress__container {
      flex-grow: 1 !important;
      min-width: 0 !important;
    }
    
    .plyr__controls .plyr__controls__item.plyr__progress__container {
      margin: 0 10px !important;
    }
    
    .plyr__controls .plyr__controls__item:first-child {
      margin-left: 0 !important;
    }
    
    .plyr__controls .plyr__controls__item:last-child {
      margin-right: 0 !important;
    }
    
    /* تصميم جديد لنافذة التليجرام */
    .telegram-modal .modal-content {
      background: linear-gradient(135deg, #1a1a1a, #262626);
      color: var(--text);
      padding: 2.8rem 2rem;
      border: 2px solid var(--primary-1);
    }
    
    .telegram-modal .modal-content h3 {
      color: var(--primary-1);
      font-size: 1.8rem;
      margin-bottom: 1rem;
    }
    
    .telegram-modal .modal-content p {
      font-size: 1.15rem;
      margin-bottom: 2rem;
      opacity: 0.9;
    }
    
    .telegram-modal .modal-content img {
      border-color: var(--primary-1);
      width: 150px;
      height: 150px;
    }
    
    .telegram-btn {
      background: var(--primary-1);
      color: #333;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .telegram-btn:hover {
      background: var(--primary-2);
      color: #333;
      transform: translateY(-3px);
    }
    
    .telegram-close {
      background: rgba(255, 215, 0, 0.2);
      color: var(--primary-1);
    }
    
    .telegram-close:hover {
      background: rgba(255, 215, 0, 0.3);
      color: var(--primary-1);
    }
    
    /* ===== تحسينات جديدة ===== */
    .loading-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
      gap: 1.8rem;
    }
    
    .loading-card {
      background: var(--card);
      border-radius: var(--radius);
      border: 1px solid var(--border);
      padding: 1.5rem;
      text-align: center;
      animation: pulse 1.5s infinite;
    }
    
    .loading-img {
      width: 140px;
      height: 140px;
      border-radius: 50%;
      background: var(--bg);
      margin: 0 auto 1rem;
    }
    
    .loading-line {
      height: 1.5rem;
      background: var(--bg);
      border-radius: 4px;
      margin-bottom: 0.5rem;
    }
    
    .loading-line.short {
      width: 70%;
      margin: 0 auto;
    }
    
    /* زر إعادة المحاولة */
    .retry-btn {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-top: 1rem;
      padding: 0.7rem 1.2rem;
      background: var(--primary-1);
      color: #333;
      border-radius: var(--radius);
      font-weight: 600;
    }
    
    /* أزرار التقديم والتأخير داخل المشغل */
    .plyr__controls .plyr__controls__item[data-plyr="rewind"],
    .plyr__controls .plyr__controls__item[data-plyr="forward"] {
      display: flex !important;
      align-items: center;
      justify-content: center;
    }
  </style>
</head>
<body>
  <header>
    <h1 class="site-title" onclick="navigate('home')">
      <img class="site-logo" src="https://www2.0zz0.com/2025/06/27/17/886863953.jpg" alt="شعار منصة صدقة تعليمية"> 
      Educational Sadaqah 
    </h1>
    
    <div class="header-actions">
      <button id="themeToggle" class="btn"><i data-lucide="sun"></i><span>المظهر</span></button>
      <!-- زر كروب الملازم -->
      <button id="malazmButton" class="btn"><i data-lucide="book"></i><span>ملازم المتميزين  </span></button>
      <!-- زر كروب الدردشة -->
      <button id="chatButton" class="btn"><i data-lucide="messages-square"></i><span> دردشة المتميزين </span></button>
    </div>
    
    <div class="search-container">
      <i class="search-icon" data-lucide="search"></i>
      <input id="searchInput" type="text" placeholder="ابحث عن مدرس…">
      <button id="searchButton" class="btn btn-icon"><i data-lucide="search"></i></button>
    </div>
  </header>

  <div id="homePage" class="page active">
    <div id="teachersGrid" class="teachers-grid">
      <div class="loading-grid">
        <div class="loading-card">
          <div class="loading-img"></div>
          <div class="loading-line"></div>
          <div class="loading-line short"></div>
        </div>
        <div class="loading-card">
          <div class="loading-img"></div>
          <div class="loading-line"></div>
          <div class="loading-line short"></div>
        </div>
        <div class="loading-card">
          <div class="loading-img"></div>
          <div class="loading-line"></div>
          <div class="loading-line short"></div>
        </div>
      </div>
    </div>
  </div>

  <div id="classesPage" class="page">
    <button class="btn back-button" onclick="navigate('home')"><i data-lucide="arrow-right"></i>الرجوع للمدرسين</button>
    <div class="teacher-info">
      <img id="teacherImage" class="teacher-img-lg" alt="">
      <div>
        <h2 id="teacherName"></h2>
        <p id="teacherSubject" class="teacher-subject"></p>
      </div>
    </div>
    <div id="classesList" class="classes-list"></div>
  </div>

  <div id="videoPage" class="page">
    <div class="video-page">
      <div id="videoContainer" class="video-container">
        <div id="loader"><div class="spinner"></div></div>
        <video id="player" playsinline controls></video>
      </div>
      
      <div class="video-details">
        <h2 id="videoTitle"></h2>
        <p id="videoDescription"></p>
        
        <div id="errorMessage" class="error-message"></div>
        
        <div class="video-info">
          <div class="video-meta">
            <span><i data-lucide="calendar"></i> تاريخ النشر: <span id="videoDate">--/--/----</span></span>
          </div>
        </div>
        
        <button class="btn back-button" onclick="navigate('classes')"><i data-lucide="arrow-right"></i>العودة للفصول</button>
      </div>
    </div>
  </div>

  <div id="telegramModal" class="modal telegram-modal" style="display: flex">
    <div class="modal-content">
      <img src="https://www2.0zz0.com/2025/06/27/17/886863953.jpg" alt="قناة التليجرام">
      <h3> Educational Sadaqah | ٱلصَّدَقَةُ ٱلدِّرَاسِيَّةُ </h3>
            <p> منصة خاصة بمحاضرات مدارس المتميزين (قريباً)  </p>

      <div class="modal-actions">
        <a href="https://t.me/Distingushed_0" target="_blank" class="btn telegram-btn"><i data-lucide="send"></i><span>اشترك في القناة</span></a>
        <button class="close-channel telegram-close" onclick="closeModal()"><i data-lucide="x-circle"></i><span> فتح المنصة </span></button>
      </div>
    </div>
  </div>

  <script src="https://cdn.plyr.io/3.7.8/plyr.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

  
  <script type="text/babel">
    /* ========= السمــة ========= */
    function initializeTheme() {
      const stored = localStorage.getItem('theme');
      const preferred = window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark';
      const theme = stored || preferred;
      document.documentElement.setAttribute('data-theme', theme);
      updateThemeIcon(theme);
    }
    
    function updateThemeIcon(theme) {
      document.querySelector('#themeToggle i').setAttribute('data-lucide', theme === 'dark' ? 'sun' : 'moon');
      lucide.createIcons();
    }
    
    initializeTheme();
    
    document.getElementById('themeToggle').addEventListener('click', () => {
      const cur = document.documentElement.getAttribute('data-theme');
      const next = cur === 'dark' ? 'light' : 'dark';
      document.documentElement.setAttribute('data-theme', next);
      localStorage.setItem('theme', next);
      updateThemeIcon(next);
    });

    /* ========= أزرار كروب الملازم والدردشة ========= */
    document.getElementById('malazmButton').addEventListener('click', () => {
      window.open('قريباً', '_blank');
    });
    
    document.getElementById('chatButton').addEventListener('click', () => {
      window.open('قريباً', '_blank');
    });

    /* ========= إعداد المشغل ========= */
    const player = new Plyr('#player', {
      controls: [
        'play-large',
        'play',
        'rewind',
        'forward',
        'progress',
        'current-time',
        'fullscreen',
        'settings'
      ],
      keyboard: { focused: true, global: true },
      tooltips: { controls: true, seek: true },
      captions: { active: false },
      settings: ['quality', 'speed'],
      speed: { selected: 1, options: [0.5, 0.75, 1, 1.25, 1.5, 2] },
      vimeo: { 
        byline: false,
        portrait: false,
        title: false,
        speed: true,
        transparent: false
      },
      // إعدادات التقديم والتأخير
      rewind: 10,
      forward: 10
    });

    // مراجع DOM
    const loader = document.getElementById('loader');
    const videoContainer = document.getElementById('videoContainer');
    const errorMessage = document.getElementById('errorMessage');
    const teacherImage = document.getElementById('teacherImage');
    const teacherName = document.getElementById('teacherName');
    const teacherSubject = document.getElementById('teacherSubject');
    const videoTitle = document.getElementById('videoTitle');
    const videoDescription = document.getElementById('videoDescription');
    const telegramModal = document.getElementById('telegramModal');
    const classesList = document.getElementById('classesList');
    const teachersGrid = document.getElementById('teachersGrid');
    
    // متغيرات التقدم
    let lectureProgress = JSON.parse(localStorage.getItem('lectureProgress')) || {};
    let teachers = [];
    let currentTeacher = null;
    let currentClassIndex = 0;
    let currentLectureIndex = 0;
    let currentLectureLink = '';

    // وظيفة تشغيل قسرية بعد أي توقف أو تجميد
    function forcePlay() {
      if (player.paused) {
        player.play().catch(err => {
          console.log('محاولة تشغيل مرة أخرى...');
          setTimeout(forcePlay, 500);
        });
      }
    }

    // التنقل بين الصفحات
    const pages = {
      home: document.getElementById('homePage'),
      classes: document.getElementById('classesPage'),
      video: document.getElementById('videoPage')
    };

    function navigate(page) {
      window.scrollTo({ top: 0, behavior: 'smooth' });

      if (page !== 'video') {
        // تنظيف الفيديو
        player.pause();
        player.currentTime = 0;
        player.source = null;
        loader.classList.remove('show');
        videoContainer.classList.remove('loading');
        player.elements.container.style.display = 'block';
        
        if (window.hlsInstance) {
          window.hlsInstance.destroy();
          window.hlsInstance = null;
        }
      }

      Object.values(pages).forEach(p => p.classList.remove('active'));
      pages[page].classList.add('active');
      hideError();
    }

    // عرض رسائل الخطأ
    function showError(msg) {
      errorMessage.textContent = msg;
      errorMessage.style.display = 'block';
    }
    
    function hideError() {
      errorMessage.style.display = 'none';
    }

    /* ========= بيانات المدرسين ========= */
    const searchInput = document.getElementById('searchInput');
    const searchBtn = document.getElementById('searchButton');

    function renderTeachers(list = teachers) {
      if (!list.length) {
        teachersGrid.innerHTML = '<p>لا توجد نتائج مطابقة.</p>';
        return;
      }
      
      teachersGrid.innerHTML = '';
      
      list.forEach((t, idx) => {
        const card = document.createElement('div');
        card.className = 'teacher-card';
        card.style.setProperty('--i', idx);
        card.innerHTML = `
          <img class="teacher-img" src="${t.image}" alt="${t.name}">
          <h3 class="teacher-name">${t.name}</h3>
          <p class="teacher-subject">${t.subject}</p>
        `;
        card.onclick = () => showTeacher(t.id);
        teachersGrid.appendChild(card);
      });
    }

    window.showTeacher = (id) => {
      currentTeacher = teachers.find(t => t.id == id);
      if (!currentTeacher) return;
      
      teacherImage.src = currentTeacher.image;
      teacherName.textContent = currentTeacher.name;
      teacherSubject.textContent = currentTeacher.subject;
      
      renderClasses(currentTeacher.classes);
      navigate('classes');
    };

    function renderClasses(classesData) {
      classesList.innerHTML = classesData.map((cls, ci) => {
        const lectures = cls.lectures.map((lec, li) => {
          return `
            <div class="lecture-item" 
                 onclick="playLecture(${ci}, ${li}, '${lec.url}', '${lec.title}', '${lec.description}')">
              <i data-lucide="play-circle"></i>
              <span>${li + 1}. ${lec.title}</span>
            </div>
          `;
        }).join('');
        
        return `
          <div class="class-card">
            <div class="class-header" onclick="toggleLectures(this)">
              <h3>${cls.name}</h3>
              <span data-lucide="chevron-down"></span>
            </div>
            <div class="lectures-list">${lectures}</div>
          </div>
        `;
      }).join('');
      
      lucide.createIcons();
    }

    window.toggleLectures = (header) => {
      const list = header.parentElement.querySelector('.lectures-list');
      const icon = header.querySelector('[data-lucide]');
      const open = list.style.display !== 'flex';
      
      list.style.display = open ? 'flex' : 'none';
      header.classList.toggle('open', open);
      icon.setAttribute('data-lucide', open ? 'chevron-up' : 'chevron-down');
      lucide.createIcons();
    };

    window.playLecture = (ci, li, url, title, desc) => {
      [currentClassIndex, currentLectureIndex, currentLectureLink] = [ci, li, url];
      videoTitle.textContent = title;
      videoDescription.textContent = desc;

      const videoContainer = document.getElementById('videoContainer');
      const loader = document.getElementById('loader');
      const errorMessage = document.getElementById('errorMessage');

      document.getElementById('videoDate').textContent = '15/10/2026';

      // ✅ دعم فيديوهات .m3u8 و mp4 فقط
      videoContainer.innerHTML = `
        <div id="loader"><div class="spinner"></div></div>
        <video id="player" playsinline controls></video>
      `;
      lucide.createIcons();

      const videoElement = document.getElementById('player');
      const isHLS = url.endsWith('.m3u8');
      const referer = "https://abwaab.com";
      
      // قائمة بثلاثة روابط بروكسي بديلة
      const proxyUrls = [
        `https://proxyh1.glitch.me/proxy?url=${encodeURIComponent(url)}&referer=${encodeURIComponent(referer)}`,
        `https://knotty-quill-ferryboat.glitch.me/proxy?url=${encodeURIComponent(url)}&referer=${encodeURIComponent(referer)}`,
        `https://messy-bittersweet-velociraptor.glitch.me/proxy?url=${encodeURIComponent(url)}&referer=${encodeURIComponent(referer)}`
      ];
      
      let proxyIndex = 0;
      let retryCount = 0;
      const maxRetries = 3;

      if (window.hlsInstance) {
        window.hlsInstance.destroy();
        window.hlsInstance = null;
      }

      const player = new Plyr('#player', {
        controls: ['play-large', 'play', 'rewind', 'forward', 'progress', 'current-time', 'fullscreen', 'settings'],
        keyboard: { focused: true, global: true },
        tooltips: { controls: true, seek: true },
        captions: { active: false },
        settings: ['quality', 'speed'],
        speed: { selected: 1, options: [0.5, 0.75, 1, 1.25, 1.5, 2] },
        rewind: 10,
        forward: 10
      });

      // تعريب تلميحات أزرار التأخير والتقديم
      player.on('ready', () => {
        // زر التأخير
        const rewindButton = player.elements.container.querySelector('[data-plyr="rewind"]');
        if (rewindButton) {
          rewindButton.title = 'تأخير 10 ثواني';
          rewindButton.innerHTML = '<svg width="18" height="18" viewBox="0 0 18 18"><path d="M4.5 5.5v7l7-3.5zm7 0v7l7-3.5z" fill="currentColor"></path></svg>';
        }
        
        // زر التقديم
        const forwardButton = player.elements.container.querySelector('[data-plyr="forward"]');
        if (forwardButton) {
          forwardButton.title = 'تقديم 10 ثواني';
          forwardButton.innerHTML = '<svg width="18" height="18" viewBox="0 0 18 18"><path d="M6.5 5.5l7 3.5-7 3.5zm7 0l7 3.5-7 3.5z" fill="currentColor"></path></svg>';
        }
      });

      loader.classList.add('show');
      videoContainer.classList.add('loading');
      errorMessage.style.display = 'none';

      function tryPlay() {
        if (proxyIndex >= proxyUrls.length) {
          proxyIndex = 0; // العودة للبداية عند نفاد الخيارات
          retryCount++;
          
          if (retryCount > maxRetries) {
            showError("⚠️ فشل في تحميل الفيديو بعد عدة محاولات");
            loader.classList.remove('show');
            videoContainer.classList.remove('loading');
            return;
          }
        }
        
        const proxyUrl = proxyUrls[proxyIndex];
        proxyIndex++;
        
        if (isHLS && Hls.isSupported()) {
          const hls = new Hls();
          window.hlsInstance = hls;
          hls.attachMedia(videoElement);
          hls.loadSource(proxyUrl);

          hls.on(Hls.Events.MANIFEST_PARSED, () => {
            player.play().then(() => {
              loader.classList.remove('show');
              videoContainer.classList.remove('loading');
            }).catch(console.error);
          });

          hls.on(Hls.Events.ERROR, (_, data) => {
            if (data.fatal) {
              console.log(`⚠️ خطأ في البروكسي ${proxyIndex-1}, جرب بروكسي آخر...`);
              tryPlay(); // جرب رابط بروكسي آخر
            }
          });

        } else {
          player.source = {
            type: 'video',
            sources: [{
              src: proxyUrl,
              type: isHLS ? 'application/x-mpegURL' : 'video/mp4'
            }]
          };

          player.play().then(() => {
            loader.classList.remove('show');
            videoContainer.classList.remove('loading');
          }).catch((e) => {
            console.log(`⚠️ خطأ في البروكسي ${proxyIndex-1}: ${e.message}, جرب بروكسي آخر...`);
            tryPlay(); // جرب رابط بروكسي آخر
          });
        }
      }

      tryPlay();
      navigate('video');
    };

   /* ========= البحث ========= */
    function handleSearch() {
      const term = searchInput.value.trim().toLowerCase();
      renderTeachers(teachers.filter(t => 
        t.name.toLowerCase().includes(term) || 
        t.subject.toLowerCase().includes(term)
      ));
    }
    
    let searchTimeout;
    searchInput.addEventListener('input', () => {
      clearTimeout(searchTimeout);
      searchTimeout = setTimeout(handleSearch, 250);
    });
    
    searchBtn.addEventListener('click', handleSearch);

    /* ========= تحميل البيانات ========= */
    function loadData() {
      const endpoint = 'https://max22.glitch.me/api/2data'; // تحميل سنة 2026 تلقائياً
      const err = '<p style="color:red">حدث خطأ في تحميل البيانات.</p><button class="btn" onclick="location.reload()">إعادة المحاولة</button>';
      
      teachersGrid.innerHTML = '<div class="loading-grid"><div class="loading-card"><div class="loading-img"></div><div class="loading-line"></div><div class="loading-line short"></div></div><div class="loading-card"><div class="loading-img"></div><div class="loading-line"></div><div class="loading-line short"></div></div><div class="loading-card"><div class="loading-img"></div><div class="loading-line"></div><div class="loading-line short"></div></div></div>';
      
      fetch(endpoint, {
        headers: {
          Referer: 'https://careful-burnt-honesty.glitch.me/',
          'Cache-Control': 'no-cache'
        }
      })
      .then(r => {
        if (!r.ok) throw new Error();
        return r.json();
      })
      .then(data => {
        teachers = data.teachers;
        renderTeachers();
      })
      .catch(() => {
        teachersGrid.innerHTML = err;
      });
    }

    /* ========= Modal ========= */
    window.closeModal = () => {
      telegramModal.style.display = 'none';
      loadData(); // تحميل بيانات سنة 2026 مباشرة بعد إغلاق نافذة التليجرام
    };
    
    telegramModal.addEventListener('click', e => {
      if (e.target.id === 'telegramModal') closeModal();
    });
    
    lucide.createIcons();
    
    // إظهار نافذة التليجرام عند بدء التشغيل
    setTimeout(() => {
      telegramModal.style.display = 'flex';
    }, 500);
  </script>
</body>
</html>